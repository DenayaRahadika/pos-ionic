{"version":3,"sources":["../../src/pages/map/map.module.ts","../../src/pages/map/map.ts"],"names":[],"mappings":"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","file":"1.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MapPage } from './map';\n\n@NgModule({\n  declarations: [\n    MapPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(MapPage),\n  ],\n})\nexport class MapPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/map/map.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, Loading, LoadingController} from 'ionic-angular';\n\nimport { Geolocation } from '@ionic-native/geolocation';\n\nimport { FirebaseListObservable } from 'angularfire2/database';\nimport { VendedorService } from '../../providers/vendedor.service';\n\ndeclare var google;\n\n@IonicPage()\n@Component({\n  selector: 'page-map',\n  templateUrl: 'map.html',\n})\nexport class MapPage {\n\n  map: any;\n  dato: any = null;\n  load: Loading;\n  datos: FirebaseListObservable<any>;\n  vendedor: any;\n  myPosition: any = {};\n  bounds: any = null;\n  infowindow: any;\n\n  constructor(\n    public navCtrl: NavController, \n    public navParams: NavParams,\n    private loadCtrl: LoadingController,\n    public geolocation: Geolocation,\n    public vendedorService: VendedorService\n  ) {\n    this.dato = this.navParams.get('vendedor');\n    console.log(this.dato);\n    this.bounds = new google.maps.LatLngBounds();\n    this.infowindow = new google.maps.InfoWindow();\n  }\n\n  ionViewDidLoad() {\n    let load = this.loadCtrl.create({\n      content: 'Cargando...'\n    });\n    // load.present();\n    // load.dismiss(); \n    this.loadMap();\n  }\n  \n  private loadMap(){   \n    //create a new map by passing HTMLElement\n    let mapEle: HTMLElement = document.getElementById('map');\n  \n    let latitud = -17.2378799;\n    let longitud = -66.7239997;\n\n    // create LatLng object\n    let myLatLng = { lat: latitud, lng: longitud };\n    \n    // create map\n    this.map = new google.maps.Map(mapEle, {\n      center: myLatLng,\n      zoom: 12\n    });\n      \n    google.maps.event.addListenerOnce(this.map, 'idle', () => {\n      mapEle.classList.add('show-map');\n        this.obtenerVendedor();\n    }); \n    \n  }\n\n  private obtenerVendedor(){\n    this.vendedorService.getVendedor(this.dato.$key).subscribe((vendedor)=>{ \n      this.vendedor = vendedor;\n      console.log(this.vendedor);\n      let latitud = this.vendedor.PosicionActual.latitud;\n      let longitud = this.vendedor.PosicionActual.longitud;\n      this.myPosition = { lat: latitud, lng: longitud },\n      this.map.setCenter({\n        lat: latitud, \n        lng: longitud\n      });\n      let icon = `https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld`;\n      this.createMarker(latitud, longitud, icon, 'Vendedor');\n      this.renderMarkers();\n    });\n  }\n\n  private createMarker(lat: number, lng: number, icon: string, title: string){\n        let options = {\n          position: {\n            lat: lat,\n            lng: lng\n          },\n          title: title,\n          map: this.map,\n          icon: icon,\n          zIndex: Math.round(lat*-100000)<<5\n        }\n        let marker = new google.maps.Marker(options);\n\n        marker.addListener('click', ()=>{\n          this.infowindow.setContent(title); \n          this.infowindow.open(this.map, marker);\n        });\n        return marker;\n      }\n\n  private fitBounds(points: any[]){     \n    this.bounds.extend(this.myPosition);\n      for(let key in points){\n        let point = points[key];\n        var myLatlng = new google.maps.LatLng(point.latitud, point.longitud);\n        this.bounds.extend(myLatlng);\n      }\n    this.map.fitBounds(this.bounds);\n    }\n  \n  private renderMarkers(){\n    let geoPuntosList = this.vendedor['registro:09-12-2017'].geoPuntoList;\n    this.fitBounds(geoPuntosList);\n    let lines = [];\n      for(let key in geoPuntosList) {\n          let client = geoPuntosList[key];\n          let icon = './assets/imgs/default.png';\n          if(client.tipo == 'PEDIDO'){\n            icon = './assets/imgs/pedido.png';\n          }else if(client.tipo == 'DEVOLUCION' ){\n            icon = './assets/imgs/devolucion.png';\n          }else if(client.tipo == 'VISITA'){\n            icon = './assets/imgs/visita.png';\n          }else if(client.tipo == 'VENTA'){\n            icon = './assets/imgs/venta.png';\n          }\n    this.createMarker(client.latitud, client.longitud, icon, client.tipo);\n    lines.push({ lat: client.latitud, lng: client.longitud });   \n  }\n\n    let linesPath = new google.maps.Polyline({\n      path: lines,\n      geodesic: true,           \n      strokeColor: '#FF0000',           \n      strokeOpacity: 1.0,           \n      strokeWeight: 2\n    });\n  linesPath.setMap(this.map);\n  } \n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/map/map.ts"],"sourceRoot":""}